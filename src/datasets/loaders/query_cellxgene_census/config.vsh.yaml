functionality:
  name: query_cellxgene_census
  namespace: "loaders"
  description: "Query CellxGene Census or user-specified TileDBSoma object, and eventually fetch cell and gene metadata or/and expression counts."
  argument_groups:
    - name: Inputs
      description: "Arguments related to the input (aka query) dataset."
      arguments:
        - name: "--cellxgene_release"
          description: "CellxGene Census release date. More information: https://chanzuckerberg.github.io/cellxgene-census/cellxgene_census_docsite_data_release_info.html"
          type: string
          default: "2023-07-25"
          required: false
    - name: Query
      description: Arguments related to the query.
      arguments:
        - name: "--dataset_id"
          type: string
          description: "Dataset ID(s) of interest."
          required: false
          multiple: true
        - name: "--species"
          type: string
          description: "Specie(s) of interest. If not specified, Homo Sapiens will be queried."
          required: false
          example: "homo_sapiens"
          default: "homo_sapiens"
          choices: ["homo_sapiens", "mus_musculus"]
          multiple: false
        - name: "--cell_query"
          type: string
          description: "The query for selecting the cells as defined by the cellxgene census schema."
          required: false
          example: "is_primary_data == True and cell_type_ontology_term_id in ['CL:0000136', 'CL:1000311', 'CL:0002616'] and suspension_type == 'cell'"
    - name: Outputs
      description: Output arguments.
      arguments:
        - name: "--output"
          type: file
          description: Output h5ad file.
          direction: output
          required: true
          example: output.h5ad
  resources:
    - type: python_script
      path: script.py
  test_resources:
    - type: python_script
      path: test.py
platforms:
  - type: docker
    image: ghcr.io/openproblems-bio/base_python:1.0.2
    setup:
      - type: python
        packages:
          - cellxgene-census~=1.2.0
          - obonet~=1.0.0
    test_setup:
      - type: python
        packages:
          - viashpy~=0.5.0
  - type: nextflow
    directives:
      label: [midtime, highmem, midcpu]