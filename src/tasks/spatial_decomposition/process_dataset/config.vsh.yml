__merge__: ../api/comp_process_dataset.yaml
functionality:
  name: "process_dataset"
  arguments:
    - name: --generate_dataset
      type: boolean
      description: Should a synthetic spatial dataset be created?
      default: true
    - name: --alpha
      type: double
      description: Alpha value to use for generating synthetic dataset
      default: 1.0
    - name: --simulated_data
      type: file
      direction: output
      description: Simulated dataset
      required: false
      example: dataset_simulated.h5ad
      info:
        slots:
          layers:
            - type: integer
              name: counts
              description: Raw counts.
              required: true
          obs:
            - type: string
              name: cell_type
              description: Cell type label IDs.
              required: true
            - type: string
              name: batch
              description: A batch identifier. This label is very context-dependent and may be a combination of the tissue, assay, donor, etc.
              required: true
          var:
            - type: boolean
              name: hvg
              description: Whether or not the feature is considered to be a 'highly variable gene'
              required: true
            - type: integer
              name: hvg_score
              description: A ranking of the features by hvg.
              required: true
          obsm:
            - type: double
              name: X_pca
              description: The resulting PCA embedding.
              required: true
            - type: double
              name: coordinates
              description: XY coordinates for each spot.
              required: true
            - type: double
              name: proportions_true
              description: True cell type proportions for each spot
              required: true
          uns:
            - type: string
              name: cell_type_names
              description: Cell type names corresponding to values in `cell_type`
              required: true
            - type: string
              name: dataset_id
              description: "A unique identifier for the dataset"
              required: true
            - name: dataset_name
              type: string
              description: Nicely formatted name.
              required: true
            - type: string
              name: dataset_url
              description: Link to the original source of the dataset.
              required: false
            - name: dataset_reference
              type: string
              description: Bibtex reference of the paper in which the dataset was published.
              required: false
            - name: dataset_summary
              type: string
              description: Short description of the dataset.
              required: true
            - name: dataset_description
              type: string
              description: Long description of the dataset.
              required: true
            - name: dataset_organism
              type: string
              description: The organism of the sample in the dataset.
              required: false
  resources:
    - type: python_script
      path: script.py
    - path: /src/common/helper_functions/subset_anndata.py
    - type: python_script
      path: /src/tasks/spatial_decomposition/datasets/sample_datasets.py
    - type: python_script
      path: /src/tasks/spatial_decomposition/datasets/utils.py
platforms:
  - type: docker
    image: ghcr.io/openproblems-bio/base_python:1.0.2
  - type: nextflow
    directives: 
      label: [ midtime, highmem, highcpu ]
