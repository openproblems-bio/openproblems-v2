functionality:
  name: "combat"
  namespace: "batch_integration/methods"
  version: "main_build"
  arguments:
  - type: "file"
    name: "--input"
    description: "Unintegrated AnnData HDF5 file."
    info:
      short_description: "Unintegrated"
      slots:
        layers:
        - type: "integer"
          name: "counts"
          description: "Raw counts"
          required: true
        - type: "double"
          name: "normalized"
          description: "Normalized expression values"
          required: true
        obs:
        - type: "string"
          name: "batch"
          description: "Batch information"
          required: true
        - type: "string"
          name: "label"
          description: "label information"
          required: true
        var:
        - type: "boolean"
          name: "hvg"
          description: "Whether or not the feature is considered to be a 'highly variable\
            \ gene'"
          required: true
        obsm:
        - type: "double"
          name: "X_pca"
          description: "The resulting PCA embedding."
          required: true
        obsp:
        - type: "double"
          name: "knn_connectivities"
          description: "K nearest neighbors connectivities matrix."
          required: true
        uns:
        - type: "string"
          name: "dataset_id"
          description: "A unique identifier for the dataset"
          required: true
        - type: "string"
          name: "normalization_id"
          description: "Which normalization was used"
          required: true
        - type: "string"
          name: "dataset_organism"
          description: "Which normalization was used"
          required: true
    example:
    - "resources_test/batch_integration/pancreas/unintegrated.h5ad"
    must_exist: true
    create_parent: true
    required: false
    direction: "input"
    multiple: false
    multiple_sep: ":"
    dest: "par"
  - type: "file"
    name: "--output"
    description: "Integrated AnnData HDF5 file."
    info:
      prediction_type: "feature"
      short_description: "Integrated Feature"
      slots:
        layers:
        - type: "integer"
          name: "counts"
          description: "Raw counts"
          required: true
        - type: "double"
          name: "normalized"
          description: "Normalized expression values"
          required: true
        - type: "double"
          name: "corrected_counts"
          description: "Corrected counts after integration"
          required: true
        uns:
        - type: "string"
          name: "dataset_id"
          description: "A unique identifier for the dataset"
          required: true
        - type: "string"
          name: "normalization_id"
          description: "Which normalization was used"
          required: true
        - type: "string"
          name: "dataset_organism"
          description: "Which normalization was used"
          required: true
        - type: "string"
          name: "method_id"
          description: "A unique identifier for the method"
          required: true
        - type: "boolean"
          name: "hvg"
          description: "If the method was done on hvg or full"
          required: true
        - type: "string"
          name: "output_type"
          description: "what kind of output has been generated"
          required: true
        obs:
        - type: "string"
          name: "batch"
          description: "Batch information"
          required: true
        - type: "string"
          name: "label"
          description: "label information"
          required: true
        var:
        - type: "boolean"
          name: "hvg"
          description: "Whether or not the feature is considered to be a 'highly variable\
            \ gene'"
          required: true
        obsm:
        - type: "double"
          name: "X_pca"
          description: "The resulting PCA embedding."
          required: true
        obsp:
        - type: "double"
          name: "knn_connectivities"
          description: "K nearest neighbors connectivities matrix."
          required: true
    example:
    - "resources_test/batch_integration/pancreas/combat.h5ad"
    must_exist: true
    create_parent: true
    required: false
    direction: "output"
    multiple: false
    multiple_sep: ":"
    dest: "par"
  - type: "boolean"
    name: "--hvg"
    description: "Whether to subset to highly variable genes"
    default:
    - false
    required: false
    direction: "input"
    multiple: false
    multiple_sep: ":"
    dest: "par"
  resources:
  - type: "python_script"
    path: "script.py"
    is_executable: true
  test_resources:
  - type: "file"
    path: "resources_test/batch_integration/pancreas"
    dest: "resources_test/batch_integration/pancreas"
  - type: "python_script"
    path: "src/common/comp_tests/check_method_config.py"
    is_executable: true
  - type: "python_script"
    path: "src/common/comp_tests/run_and_check_adata.py"
    is_executable: true
  info:
    pretty_name: "Combat"
    summary: "Adjusting batch effects in microarray expression data using empirical\
      \ Bayes methods"
    description: "\"An Empirical Bayes (EB) approach to correct for batch effects.\
      \ It\nestimates batch-specific parameters by pooling information across genes\
      \ in\neach batch and shrinks the estimates towards the overall mean of the batch\n\
      effect estimates across all genes. These parameters are then used to adjust\n\
      the data for batch effects, leading to more accurate and reproducible\nresults.\"\
      \n"
    reference: "hansen2012removing"
    repository_url: "https://scanpy.readthedocs.io/en/stable/api/scanpy.pp.combat.html"
    documentation_url: "https://scanpy.readthedocs.io/en/stable/api/scanpy.pp.combat.html"
    v1_url: "openproblems/tasks/_batch_integration/batch_integration_graph/methods/combat.py"
    v1_commit: "29803b95c88b4ec5921df2eec7111fd5d1a95daf"
    preferred_normalization: "log_cpm"
    variants:
      combat_full_unscaled: null
      combat_hvg_unscaled:
        hvg: true
      combat_full_scaled:
        preferred_normalization: "log_cpm_scaled"
      combat_hvg_scaled:
        hvg: true
        preferred_normalization: "log_cpm_scaled"
    type: "method"
    output_type: "feature"
    type_info:
      label: "Method (feature)"
      description: "A batch integration method which outputs a batch-corrected feature-space.\n"
  status: "enabled"
  set_wd_to_resources_dir: false
platforms:
- type: "docker"
  id: "docker"
  image: "mumichae/scib-base:1.1.3"
  target_organization: "openproblems-bio"
  target_registry: "ghcr.io"
  namespace_separator: "/"
  resolve_volume: "Automatic"
  chown: true
  setup_strategy: "ifneedbepullelsecachedbuild"
  target_image_source: "https://github.com/openproblems-bio/openproblems-v2"
  setup:
  - type: "python"
    user: false
    pypi:
    - "pyyaml"
    upgrade: true
- type: "nextflow"
  id: "nextflow"
  variant: "vdsl3"
  directives:
    tag: "$id"
  auto:
    simplifyInput: true
    simplifyOutput: true
    transcript: false
    publish: false
  debug: false
  container: "docker"
info:
  config: "/home/runner/work/openproblems-v2/openproblems-v2/src/tasks/batch_integration/methods/combat/config.vsh.yaml"
  platform: "nextflow"
  output: "/home/runner/work/openproblems-v2/openproblems-v2/target/nextflow/batch_integration/methods/combat"
  executable: "/home/runner/work/openproblems-v2/openproblems-v2/target/nextflow/batch_integration/methods/combat/combat"
  viash_version: "0.7.3"
  git_commit: "94b49b8f452d5c39ffc6f41cf43a387c3ea97976"
  git_remote: "https://github.com/openproblems-bio/openproblems-v2"
